# TFT螢幕與模擬程式同步功能總結

## 已完成的功能

### 1. Arduino端TFT螢幕顯示
- **樓層顯示區域**（上方2/3）：
  - 黑色背景，白色文字
  - 靜止時顯示目前樓層：1、2、3
  - 上升時顯示：↑2、↑3
  - 下降時顯示：↓2、↓1

- **狀態顯示區域**（下方1/3）：
  - 長方形邊框設計
  - 手動緊急：紅色框 + "EMERGENCY" / "Emergency"
  - 自動緊急：綠色框 + "EXPRESS" / "Express"
  - 正常運轉：白色框 + "NORMAL" / "Normal"
  - 每秒切換中英文顯示

### 2. Python端狀態同步
- **狀態發送**：Python程式會發送以下資訊給Arduino：
  - `STATUS`: 運轉狀態（NORMAL/EMERGENCY/FULL）
  - `FLOOR`: 目前樓層
  - `DIR`: 移動方向（IDLE/UP/DOWN）
  - `TARGET`: 目標樓層

- **即時更新**：
  - 電梯移動時每20幀（約1秒）發送一次狀態
  - 狀態改變時立即發送
  - 緊急模式切換時立即更新

### 3. 通訊協議
```
STATUS:NORMAL;FLOOR:1;DIR:IDLE;TARGET:1;
STATUS:EMERGENCY;FLOOR:2;DIR:UP;TARGET:3;
STATUS:FULL;FLOOR:1;DIR:DOWN;TARGET:1;
```

## 技術細節

### Arduino端
- 使用Adafruit_ST7789 TFT螢幕庫
- 螢幕解析度：240x240像素
- 旋轉180度以符合安裝方向
- 支援序列埠通訊接收Python指令

### Python端
- 修改`send_to_arduino()`函數發送詳細狀態
- 在`animate_movement()`中定期發送狀態更新
- 支援手動緊急、自動緊急、正常三種模式

## 顯示效果

### 正常運轉
```
┌─────────────────────┐
│                     │
│         1           │  ← 目前樓層
│                     │
├─────────────────────┤
│     [NORMAL]        │  ← 運轉狀態
└─────────────────────┘
```

### 上升中
```
┌─────────────────────┐
│                     │
│        ↑3           │  ← 前往3樓
│                     │
├─────────────────────┤
│     [NORMAL]        │  ← 運轉狀態
└─────────────────────┘
```

### 緊急模式
```
┌─────────────────────┐
│                     │
│         2           │  ← 目前樓層
│                     │
├─────────────────────┤
│   [EMERGENCY]       │  ← 緊急狀態（紅色）
└─────────────────────┘
```

## 注意事項

1. **中文字體**：目前使用英文顯示，如需中文請參考`arduino_car_module/README_TFT_FONT.md`

2. **螢幕腳位**：
   - CS: 10, DC: 9, RST: 8
   - MOSI: 11, SCLK: 13, BLK: 12

3. **通訊速率**：9600 baud

4. **更新頻率**：每秒更新一次顯示內容

## 測試建議

1. 上傳Arduino程式後，觀察螢幕是否顯示初始狀態
2. 在Python程式中操作電梯，觀察螢幕是否同步更新
3. 測試緊急模式切換，確認顏色和文字正確顯示
4. 測試電梯移動，確認方向箭頭正確顯示 